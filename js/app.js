"use strict";var t=document.querySelector(".cart__btn"),e=document.querySelector(".mini-cart");function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw o}}}}function a(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}t.addEventListener("click",(function(){e.classList.toggle("mini-cart--visible")})),document.addEventListener("click",(function(t){t.target.classList.contains("mini-cart")||!t.target.closest("mini-cart")||t.target.classList.contains("cart__btn")||e.classList.remove("mini-cart--visible")})),document.querySelectorAll(".faq-accordion").forEach((function(t){t.addEventListener("click",(function(t){var e=t.currentTarget,n=e.querySelector(".faq-accordion__control"),a=e.querySelector(".faq-accordion__content");e.classList.toggle("open"),e.classList.contains("open")?(n.setAttribute("aria-expanded",!0),a.setAttribute("aria-hidden",!1),a.style.maxHeight=a.scrollHeight+"px"):(n.setAttribute("aria-expanded",!1),a.setAttribute("aria-hidden",!0),a.style.maxHeight=null)}))})),ymaps.ready((function(){new ymaps.Map("map",{center:[55.76,37.64],zoom:14,controls:[]})}));var i=document.querySelector(".catalog-list"),o=document.querySelector(".catalog__more"),c=document.querySelector('[data-graph-target="prod-modal"] .modal-content'),s=c.querySelector(".modal-slider .swiper-wrapper"),l=c.querySelector(".modal-slider .modal-preview"),u=c.querySelector(".modal-info__wrapper"),d=c.querySelector(".modal-prod-descr"),m=c.querySelector(".prod-chars"),p=c.querySelector(".prod-modal__video"),_=9,v=null,f=function(t){return String(t).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")},y=new Swiper(".modal-slider__container",{autoplay:{delay:3e3},slidesPerView:1,spaceBetween:20});if(i){var h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;fetch("./resources/data/data.json").then((function(t){return t.json()})).then((function(e){v=e.length,i.innerHTML="";for(var n=0;n<v;n++)if(n<t){var a=e[n];console.log(a),i.innerHTML+='\n              <li class="catalog-list__item">\n                <article class="product">\n                  <div class="product__image">\n                    <img src="'.concat(a.mainImage,'" alt="').concat(a.title,'">\n                    <div class="product__btns">\n                      <button class="btn-reset product__btn" data-graph-path="prod-modal" data-id="').concat(a.id,'" aria-label="Показать информацию о товаре">\n                        <svg>\n                          <use xlink:href="img/sprite.svg#eye"></use>\n                        </svg>\n                      </button>\n                      <button class="btn-reset product__btn add-to-cart-btn" data-id="').concat(a.id,'" aria-label="Добавить товар в корзину">\n                        <svg>\n                          <use xlink:href="img/sprite.svg#cart"></use>\n                        </svg>\n                      </button>\n                    </div>\n                  </div>\n                  <h3 class="product__title">').concat(a.title,'</h3>\n                  <span class="product__price">').concat(f(a.price)," р</span>\n                </article>\n              </li>\n            ")}})).then((function(){document.querySelectorAll(".product__title").forEach((function(t){$clamp(t,{clamp:"22px"})})),T(),new GraphModal({isOpen:function(t){if(t.modalContainer.classList.contains("prod-modal")){var e=t.previousActiveElement.dataset.id;g(e),y.update()}}})}))};h(_);var g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;fetch("./resources/data/data.json").then((function(t){return t.json()})).then((function(e){s.innerHTML="",l.innerHTML="",u.innerHTML="",d.textContent="",m.innerHTML="",p.innerHTML="";var a,r=n(e);try{var i=function(){var e=a.value;if(e.id==t){console.log(e);var n=e.gallery.map((function(t,e){return'\n                <div class="swiper-slide" data-index="'.concat(e,'">\n                  <img src="').concat(t,'" alt="">\n                </div>\n              ')})),r=e.gallery.map((function(t,e){return'\n                <div class="modal-preview__item '.concat(0===e?"modal-preview__item--active":"",'" tabindex="0" data-index="').concat(e,'">\n                  <img src="').concat(t,'" alt="">\n                </div>\n              ')})),i=e.sizes.map((function(t,e){return'\n                <li class="modal-sizes__item">\n                  <button class="btn-reset modal-sizes__btn">'.concat(t,"</button>\n                </li>\n              ")}));s.innerHTML=n.join(""),l.innerHTML=r.join(""),u.innerHTML='\n              <div class="modal-info__top">\n                <span class="modal-info__vendor">Артикул: '.concat(e.vendor,'</span>\n                <span class="modal-info__quantity">В наличии: <span>').concat(e.quantity,'</span></span>\n              </div>\n              <h3 class="modal-info__title">').concat(e.title,'</h3>\n              <div class="modal-info__rate">\n                <img src="img/star.svg" alt="Рейтинг 5 из 5">\n                <img src="img/star.svg" alt="">\n                <img src="img/star.svg" alt="">\n                <img src="img/star.svg" alt="">\n                <img src="img/star.svg" alt="">\n              </div>\n              <div class="modal-info__sizes">\n                <span class="modal-info__subtitle">Выберите размер</span>\n                <ul class="list-reset modal-info__sizes-list modal-sizes">\n                  ').concat(i.join(""),'\n                </ul>\n              </div>\n              <div class="modal-info__price">\n                <span class="modal-info__current-price">').concat(f(e.price),' р</span>\n                <span class="modal-info__old-price">').concat(f(e.oldPrice)?f(e.oldPrice)+" р":"","</span>\n              </div>\n            "),d.textContent=e.description;var o="";Object.keys(e.chars).forEach((function(t){o+='<p class="prod-bottom__descr prod-chars__item">'.concat(t,": ").concat(e.chars[t],"</p>")})),m.innerHTML=o,e.video?(p.style.display="block",p.innerHTML='\n                <iframe src="'.concat(e.video,'"\n                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n                allowfullscreen></iframe>\n              ')):p.style.display="none"}};for(r.s();!(a=r.n()).done;)i()}catch(t){r.e(t)}finally{r.f()}})).then((function(){y.update(),y.on("slideChangeTransitionEnd",(function(){var t=document.querySelector(".swiper-slide-active").dataset.index;document.querySelectorAll(".modal-preview__item").forEach((function(t){t.classList.remove("modal-preview__item--active")})),document.querySelector('.modal-preview__item[data-index="'.concat(t,'"]')).classList.add("modal-preview__item--active")})),document.querySelectorAll(".modal-preview__item").forEach((function(t){t.addEventListener("click",(function(t){var e=parseInt(t.currentTarget.dataset.index);document.querySelectorAll(".modal-preview__item").forEach((function(t){t.classList.remove("modal-preview__item--active")})),t.currentTarget.classList.add("modal-preview__item--active"),y.slideTo(e)}))}))}))};o.addEventListener("click",(function(t){h(_+=3),o.style.display=_>=v?"none":"block"}))}var b=0,q=document.querySelector(".mini-cart__list"),w=document.querySelector(".mini-cart__summ"),S=document.querySelector(".cart__count"),x=function(){w.textContent="".concat(f(b)," р")},L=function(t){S.textContent=t},k=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;fetch("./resources/data/data.json").then((function(t){return t.json()})).then((function(e){var a,r=n(e);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(i.id==t)return console.log(i),q.insertAdjacentHTML("afterbegin",'\n          <li class="mini-cart__item" data-id="'.concat(i.id,'">\n          <article class="mini-cart__product mini-product">\n            <div class="mini-product__image">\n              <img src="').concat(i.mainImage,'" alt="').concat(i.title,'">\n            </div>\n            <div class="mini-product__content">\n              <div class="mini-product__text">\n                <h3 class="mini-product__title">').concat(i.title,'</h3>\n                <span class="mini-product__price">').concat(f(i.price),'</span>\n              </div>\n              <button class="btn-reset mini-product__delete" aria-label="Удалить товар">\n              Удалить\n                <svg>\n                  <use xlink:href="img/sprite.svg#trash"></use>\n                </svg>\n              </button>\n            </div>\n          </article>\n        </li>\n          ')),i}}catch(t){r.e(t)}finally{r.f()}})).then((function(t){var e;e=t.price,b+=e,x();var n=document.querySelectorAll(".mini-cart__list .mini-cart__item").length;n>0&&S.classList.add("cart__count--visible"),L(n)}))},T=function(){document.querySelectorAll(".add-to-cart-btn").forEach((function(t){t.addEventListener("click",(function(t){var e=t.currentTarget.dataset.id;k(e),t.currentTarget.classList.add("product__btn--disabled")}))})),q.addEventListener("click",(function(t){if(t.target.classList.contains("mini-product__delete")){var n=t.target.closest(".mini-cart__item"),a=parseInt(n.querySelector(".mini-product__price").textContent.replace(/\s/g,"")),r=n.dataset.id;document.querySelector('.add-to-cart-btn[data-id="'.concat(r,'"]')).classList.remove("product__btn--disabled"),n.remove(),b-=a,x();var i=document.querySelectorAll(".mini-cart__list .mini-cart__item").length;0==i&&(S.classList.remove("cart__count--visible"),e.classList.remove("mini-cart--visible")),L(i)}}))},A=document.querySelector(".mini-cart__btn"),E=document.querySelector(".cart-modal-order__list"),z=document.querySelector(".cart-modal-order__quantity span"),M=document.querySelector(".cart-modal-order__summ span"),H=document.querySelector(".cart-modal-order__show");function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw o}}}}function a(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function I(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(r=a.key,i=void 0,i=function(t,e){if("object"!==C(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!==C(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===C(i)?i:String(i)),a)}var r,i}A.addEventListener("click",(function(){var t=document.querySelector(".mini-cart__list").innerHTML;E.innerHTML=t,z.textContent="".concat(document.querySelectorAll(".mini-cart__list .mini-cart__item").length," шт"),M.textContent="".concat(w.textContent)})),H.addEventListener("click",(function(){H.classList.toggle("cart-modal-order__show--active"),E.classList.toggle("cart-modal-order__list--visible")}));var $=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,a=t.number,r=t.title,i=n.nextBtnText,o=t.answers.map((function(e){return"checkbox"===e.type?'\n      <li class="quiz-question__item">\n        <img src="img/sneaker.jpg" alt="">\n        <label class="custom-checkbox quiz-question__label">\n          <input type="'.concat(e.type,'" class="custom-checkbox__field quiz-question__answer" data-valid="false" name="').concat(t.answer_alias,'" ').concat("text"==e.type?'placeholder="Введите ваш вариант"':"",' value="').concat("text"!==e.type?e.answer_title:"",'">\n          <span class="custom-checkbox__content">').concat(e.answer_title,"</span>\n        </label>\n      </li>\n      "):"textarea"===e.type?'\n      <label class="quiz-question__label">\n        <textarea class="quiz-question__message" placeholder="'.concat(e.answer_title,'"></textarea>\n      </label>\n      '):'\n        <label class="quiz-question__label">\n          <input type="'.concat(e.type,'" data-valid="false" class="quiz-question__answer" name="').concat(t.answer_alias,'" ').concat("text"==e.type?'placeholder="Введите ваш вариант"':"",' value="').concat("text"!==e.type?e.answer_title:"",'">\n          <span>').concat(e.answer_title,"</span>\n        </label>\n      ")}));return'\n\t\t\t<div class="quiz-question">\n\t\t\t\t<h3 class="quiz-question__title">'.concat(r,'</h3>\n\t\t\t\t<ul class="list-reset quiz-question__answers">\n\t\t\t\t\t').concat(o.join(""),'\n\t\t\t\t</ul>\n        <div class="quiz-bottom">\n          <div class="quiz-question__count">').concat(a," из ").concat(e,'</div>\n          <button type="button" class="btn btn-reset btn--thirdly quiz-question__btn" data-next-btn>').concat(i,"</button>\n        </div>\n\t\t\t</div>\n\t")},O=function(){function t(e,n,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$el=document.querySelector(e),this.options=a,this.data=n,this.counter=0,this.dataLength=this.data.length,this.resultArray=[],this.tmp={},this.init(),this.events()}var e,a,r;return e=t,(a=[{key:"init",value:function(){console.log("init!"),this.$el.innerHTML=$(this.data[this.counter],this.dataLength,this.options)}},{key:"nextQuestion",value:function(){console.log("next question!"),this.valid()?this.counter+1<this.dataLength?(this.counter++,this.$el.innerHTML=$(this.data[this.counter],this.dataLength,this.options),this.counter+1==this.dataLength&&(document.querySelector(".quiz-question__answers").style.display="block")):(console.log("А все! конец!"),document.querySelector(".quiz-questions").style.display="none",document.querySelector(".last-question").style.display="block",document.querySelector(".quiz__title").textContent="Ваша подборка готова!",document.querySelector(".quiz__descr").textContent="Оставьте свои контактные данные, чтобы бы мы могли отправить подготовленный для вас каталог"):console.log("Не валидно!")}},{key:"events",value:function(){var t=this;console.log("events!"),this.$el.addEventListener("click",(function(e){e.target==document.querySelector("[data-next-btn]")&&(t.addToSend(),t.nextQuestion()),e.target==document.querySelector("[data-send]")&&t.send()})),this.$el.addEventListener("change",(function(e){"INPUT"==e.target.tagName&&("checkbox"!==e.target.type&&"radio"!==e.target.type&&t.$el.querySelectorAll("input").forEach((function(t){t.checked=!1})),t.tmp=t.serialize(t.$el))}))}},{key:"valid",value:function(){var t=!1,e=this.$el.querySelector("textarea");return e&&e.value.length>0?t=!0:(this.$el.querySelectorAll("input").forEach((function(e){if("INPUT"===e.nodeName)switch(e.type){case"text":e.value?t=!0:e.classList.add("error");case"checkbox":e.checked?t=!0:e.classList.add("error");case"radio":e.checked?t=!0:e.classList.add("error")}})),t)}},{key:"addToSend",value:function(){this.resultArray.push(this.tmp)}},{key:"send",value:function(){if(this.valid()){var t,e=new FormData,a=n(this.resultArray);try{for(a.s();!(t=a.n()).done;){var r=t.value;for(var i in r)e.append(i,r[i].substring(0,r[i].length-1))}}catch(t){a.e(t)}finally{a.f()}fetch("mail.php",{method:"POST",body:e})}}},{key:"serialize",value:function(t){var e,n={},a="";if("object"==C(t)&&"FORM"==t.nodeName)for(var r=t.elements.length,i=0;i<r;i++)if((e=t.elements[i]).name&&!e.disabled&&"file"!=e.type&&"reset"!=e.type&&"submit"!=e.type&&"button"!=e.type)if("select-multiple"==e.type)for(j=t.elements[i].options.length-1;j>=0;j--)e.options[j].selected&&(n[n.length]=encodeURIComponent(e.name)+"="+encodeURIComponent(e.options[j].value));else("checkbox"!=e.type&&"radio"!=e.type&&e.value||e.checked)&&(a+=e.value+",",n[e.name]=a);return n}}])&&I(e.prototype,a),r&&I(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();window.quiz=new O(".quiz-form .quiz-questions",[{number:1,title:"Какой тип кроссовок рассматриваете?",answer_alias:"type",answers:[{answer_title:"кеды",type:"checkbox"},{answer_title:"кеды",type:"checkbox"},{answer_title:"кеды",type:"checkbox"},{answer_title:"кеды",type:"checkbox"},{answer_title:"кеды",type:"checkbox"},{answer_title:"кеды",type:"checkbox"}]},{number:2,title:"Какой размер вам подойдет??",answer_alias:"size",answers:[{answer_title:"менее 36",type:"checkbox"},{answer_title:"36-38",type:"checkbox"},{answer_title:"39-41",type:"checkbox"},{answer_title:"42-44",type:"checkbox"},{answer_title:"45 и больше",type:"checkbox"}]},{number:3,title:"Уточните какие-либо моменты",answer_alias:"message",answers:[{answer_title:"Введите сообщение",type:"textarea"}]}],{nextBtnText:"Следующий шаг",sendBtnText:"Отправить"});var P=document.getElementById("range-slider");if(P){noUiSlider.create(P,{start:[1e3,2e4],connect:!0,step:1,range:{min:[1e3],max:[2e4]}});var U=[document.getElementById("input-0"),document.getElementById("input-1")];P.noUiSlider.on("update",(function(t,e){U[e].value=Math.round(t[e])}));U.forEach((function(t,e){t.addEventListener("change",(function(t){var n,a,r;n=e,a=t.currentTarget.value,(r=[null,null])[n]=a,P.noUiSlider.set(r)}))}))}